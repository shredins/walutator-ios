name: App
options:
  bundleIdPrefix: tomasz.korab.App
  deploymentTarget:
  iOS: 14.0
configs:
  Debug: debug
  Testing: debug
  Release: release
settings:
  configs:
    Debug:
      SWIFT_ACTIVE_COMPILATION_CONDITIONS: DEBUG
    Testing:
      SWIFT_ACTIVE_COMPILATION_CONDITIONS: DEBUG TESTING

targets:

  App:
    type: application
    platform: iOS
    sources:
      - path: App
    dependencies:
      - target: Engine
        embed: false
    settings:
      configs:
        - ENABLE_BITCODE: NO

  Networking:
    type: framework
    platform: iOS
    testTargets:
      - NetworkingTests
    sources:
      - Networking
      - path: Resources
        buildPhase: resources
          
  NetworkingTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - NetworkingTests
      - path: Resources
        buildPhase: resources
    dependencies:
      - target: Networking
        
  Engine:
    type: framework
    platform: iOS
    testTargets:
      - EngineTests
    sources:
      - Engine
    dependencies:
      - target: Networking
        embed: false
      
  EngineTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - EngineTests
    dependencies:
      - target: Engine

schemes:

  AppOnline:
    build:
      targets:
        App: all
    run:
      config: Debug
      
  AppOffline:
    build:
      targets:
        App: all
    run:
      config: Testing

  Networking:
    build:
      targets:
        Networking: all
    run:
      config: Debug

  NetworkingTests:
    build:
      targets:
        NetworkingTests: [test]
    test:
      config: Testing
      gatherCoverageData: true
      targets:
        - name: NetworkingTests
          parallelizable: true
          randomExecutionOrder: true
          
  Engine:
    build:
      targets:
        Engine: all
    run:
      config: Debug

  EngineTests:
    build:
      targets:
        EngineTests: [test]
    test:
      config: Testing
      gatherCoverageData: true
      targets:
        - name: EngineTests
          parallelizable: true
          randomExecutionOrder: true
